syntax = 'proto3';


message User { //Minimal cached user info
    string id = 1;
    string email = 2;
    string display_username = 3;
}

message Organization { // Minimal cached organization
    string id = 1;
    string name = 2;
    string logo = 3;
    string slug = 4;
}



message FileBlob {
    string id = 1;
    string hash = 2;
    string size = 3;
    string filename = 4;
    string mime_type = 5;
    string remote_id = 6;
    string storage_path = 7;
    optional string storage_url = 8;
    optional FileMetadata rereferences = 9;
    optional string metadata = 10; // JSON as string
}

message FileMetadata {
    string id = 1;

    // Reference to physical file
    string blob_id = 2;
    optional FileBlob blob = 3;

    // User-specific information
    string original_name = 4;

    // Context and relationships
    string related_model_id = 5;
    string related_model_name = 6;
    string purpose = 7;

    // Ownership
    string uploaded_by_id = 8;
    optional string organization_id = 9;

    // User-specific metadata
    optional string metadata = 10; // JSON as string
    repeated string tags = 11;
    optional string description = 12;

    // Cached user/org data
    optional User uploaded_by = 13;
    optional Organization organization = 14;

    // Lifecycle
    string created_at = 15;
    string updated_at = 16;
    optional string last_accessed_at = 17;
    optional string expires_at = 18;
    bool voided = 19;
}

message FileUsageScope {
    string id = 1;
    string model_name = 2;
    string purpose = 3;
    optional string description = 4;
    bool voided = 5;
    string created_at = 6;
    repeated FileUsageRule rules = 7;

}

message FileUsageRule {
    string id = 1;
    string scope_id = 2;
    optional FileUsageScope scope = 3;
    int32 max_files = 4;
    bool voided = 5;
    string created_at = 6;
}