syntax = 'proto3';

import "common.message.proto";
import "files.model.proto";

message QueryFileRequest {
    QueryBuilder query_builder = 1;
    optional string search = 2;
    optional bool include_voided = 4;
    optional RequestContext context = 5;
}

message QueryFileResponse {
    repeated FileMetadata data = 1;
    string metadata = 2; // JSON as string
}

message CreateNestedBlobRequest {
    string hash = 1;
    string size = 2;
    string mime_type = 3;
    string remote_id = 4;
    string filename = 5;
    string storage_path = 6;
    optional string storage_url = 7;
    optional string metadata = 8; // JSON as string
}

message CreateFileRequest {
    QueryBuilder query_builder = 1;
    CreateNestedBlobRequest blob = 2;
    string original_name = 3;

    string related_model_id = 4;
    string related_model_name = 5;
    string purpose = 6;

    optional string metadata = 7; // JSON as string
    repeated string tags = 8;

    optional string last_accessed_at = 9;
    optional string expires_at = 10;
    optional RequestContext context = 11;
}

message CreateFileFromExistingBlobRequest {
    QueryBuilder query_builder = 1;
    string blob_id = 2;
    string original_name = 3;
    string related_model_id = 4;
    string related_model_name = 5;
    string purpose = 6;
    optional string metadata = 7; // JSON as string
    repeated string tags = 8;
    optional string last_accessed_at = 9;
    optional string expires_at = 10;
    optional RequestContext context = 11;
}

message GetByHashRequest {
    QueryBuilder query_builder = 1;
    optional RequestContext context = 3;
    string hash = 4;
}

message GetFileResponse {
    FileMetadata data = 1;
    string metadata = 2; // JSON as string
}
message GetBlobResponse {
    FileBlob data = 1;
    string metadata = 2; // JSON as string
}