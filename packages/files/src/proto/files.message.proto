syntax = 'proto3';

import "common.message.proto";
import "files.model.proto";

message QueryFileRequest {
    QueryBuilder query_builder = 1;
    optional string search = 2;
    optional bool include_voided = 4;
    optional RequestContext context = 5;
}

message QueryFileResponse {
    repeated FileMetadata data = 1;
    string metadata = 2; // JSON as string
}

message FileBlobData {
    string name = 1;
    string size = 2;
    string mime_type = 3;
    string filename = 4;
    string original_name = 5;
    bytes buffer = 6;
    string field_name = 7;
}

message CreateFileRequest {
    QueryBuilder query_builder = 1;
    FileBlobData blob = 2;
    string related_model_id = 3;
    string related_model_name = 4;
    string purpose = 5;
    optional string metadata = 6; // JSON as string
    repeated string tags = 7;
    optional string expires_at = 8;
    optional RequestContext context = 9;
}

message GetByHashRequest {
    QueryBuilder query_builder = 1;
    optional RequestContext context = 3;
    string hash = 4;
}

message GetFileResponse {
    FileMetadata data = 1;
    string metadata = 2; // JSON as string
}
message GetBlobResponse {
    FileBlob data = 1;
    string metadata = 2; // JSON as string
}

// Generate signed url
message GenerateUploadSignedUrlRequest {
    string file_name = 1;
    optional RequestContext context = 2;
    optional int32 expires_in = 3; // Default 3600 seconds
    string mime_type = 4;
    string related_model_id = 5;
    string related_model_name = 6;
    string purpose = 7;
    repeated string tags = 8;
    string size = 9;
}

message SignedUrlData  {
    string id = 1;
    string signed_url = 2;
    string expires_at = 3;
    string mime_type = 4;
    string key = 5;
    string file_name = 6;
    string original_name = 7;
    string storage_url = 8;
}

message GenerateUploadSignedUrlResponse {
    SignedUrlData data = 1;
    string metadata = 2; // JSON as string
}

